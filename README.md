# Реализация Target-Specific and Adversarial Prompt Injection against Code LLMs
Реализация на Python системы оптимизации триггеров для языковых моделей кода с использованием методов генерации на основе цепей Маркова и равномерного распределения.

## Основные возможности

- Два метода генерации триггеров:
  - На основе цепей Маркова
  - Равномерная генерация
- Оптимизация на основе градиентов
- Поддержка устройств CUDA и CPU
- Настраиваемые параметры оптимизации
- Расчет функции потерь с состовляющими противодействия

## Установка

```bash
pip install torch
pip install -U bitsandbytes
pip install accelerate
```

## Использование

```python
from trigger_optimizer import TriggerOptimizer

# Инициализация оптимизатора с вашей моделью и токенизатором
optimizer = TriggerOptimizer(model, tokenizer)

# Пример кода для оптимизации
source_code = "import os def calculate_sum(numbers):\n    "
target_code = "return sum(numbers)"

# Оптимизация триггера с использованием обоих методов
optimized_trigger = optimizer.optimize_trigger(
    source_code=source_code,
    target_code=target_code,
    method='both'  # Варианты: 'both', 'markov', 'uniform'
)
```

## Параметры

- `method`: Метод генерации триггера ('markov', 'uniform' или 'both')
- `k`: Количество токенов для обновления за итерацию
- `max_iter`: Максимальное количество итераций оптимизации
- `device`: Вычислительное устройство ('cuda' или 'cpu')

## Компоненты

### MarkovChainGenerator

Генерирует токены, похожие на ключевые слова, используя подход на основе цепей Маркова.

### TriggerOptimizer

Основной класс, который обрабатывает:
- Начальную генерацию триггеров
- Процесс оптимизации
- Расчет функции потерь
- Вычисление градиентов
- Обновление токенов

## Методы

- `generate_initial_trigger()`: Создает начальные токены триггера
- `optimize_trigger()`: Основной цикл оптимизации
- `get_loss()`: Вычисляет функцию потерь для данного триггера
- `_update_trigger()`: Обновляет токены триггера на основе градиентов
- `_compute_gradient()`: Вычисляет градиенты для оптимизации

## Требования

- Python 3.6+
- PyTorch
- NumPy

## Лицензия

MIT

## Участие в разработке

Не стесняйтесь создавать issues и предлагать улучшения!

## Пример результатов

Оптимизатор способен генерировать эффективные триггеры для различных задач трансформации кода. Результаты могут варьироваться в зависимости от входных параметров и целевого кода.

## Примечание

Данный инструмент предназначен только для исследовательских целей. Пожалуйста, используйте его ответственно и в соответствии с этическими нормами.
